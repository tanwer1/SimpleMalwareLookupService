from redis.client import Redis
from redis import BlockingConnectionPool
import json

class RedisSafetyStore(object):
    def __init__(self):
        self.redisClient = Redis(connection_pool=BlockingConnectionPool())

    def isSafe(self, url):
        # if the urlstring is in the store, then it is not safe.

        try:
            notSafe = self.redisClient.get(url)
        except:
            print("Redis read error")
            raise

        if notSafe:
            return False
        else:
            return True

    def addUnsafeResources(self, jsonContent):
        for resource in jsonContent["resources"]:
            try:
                self.redisClient.set(resource, 1)
            except:
                print("Redis write error")
                raise

        return True
